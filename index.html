<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Inspección</title>
</head>

<body>

<button onclick="mostrarPopup()">Abrir</button>

<div id="popup" style="display:none;">
  <textarea id="descripcion" placeholder="Descripción"></textarea>
  <input type="file" id="foto">
  <button onclick="guardar()">Guardar</button>
</div>

<script>

let estructuraID = 1;
let x_rel = 0;
let y_rel = 0;
  
function mostrarPopup(){
  document.getElementById("popup").style.display="block";
}

function guardar(){
  const descripcion = document.getElementById("descripcion").value;
  const file = document.getElementById("foto").files[0];

  if(!file){
    alert("Selecciona una imagen");
    return;
  }

  const reader = new FileReader();
  reader.onload = function(){
    enviarDatos(descripcion, reader.result);
  };
  reader.readAsDataURL(file);
}

function enviarDatos(descripcion, fotoBase64){

  const datos = {
    id_estructura: estructuraID,
    x: x_rel,
    y: y_rel,
    descripcion: descripcion,
    foto: fotoBase64
  };

  fetch("https://script.google.com/macros/s/AKfycbxnmZoI37EwgEFv2KpUvJj5Zp0rPBUED5aTYPlXOAfQ8N8283K8qX1Az7xvx9S6MUCg2Q/exec", {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify(datos)
  })
  .then(response => response.text())
  .then(data => {
    console.log("Respuesta servidor:", data);

    if(data.includes("OK")){
      alert("Guardado correctamente");
      location.reload();
    } else {
      alert("Error al guardar");
    }
  })
  .catch(error => {
    console.error("Error:", error);
    alert("Error de conexión");
  });
}

</script>
</body>
</html>















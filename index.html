<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Inspección</title>
</head>

<body>

<button onclick="mostrarPopup()">Abrir</button>

<div id="popup" style="display:none;">
  <textarea id="descripcion" placeholder="Descripción"></textarea>
  <input type="file" id="foto">
  <button onclick="guardar()">Guardar</button>
</div>

<script>

let estructuraID = 1;
let x_rel = 0;
let y_rel = 0;
  
function mostrarPopup(){
  document.getElementById("popup").style.display="block";
}

function guardar(){
  const descripcion = document.getElementById("descripcion").value;
  const file = document.getElementById("foto").files[0];

  if(!file){
    alert("Selecciona una imagen");
    return;
  }

  const reader = new FileReader();
  reader.onload = function(){
    enviarDatos(descripcion, reader.result);
  };
  reader.readAsDataURL(file);
}

function enviarDatos(descripcion, fotoBase64){

  const formData = new URLSearchParams();
  formData.append("id_estructura", estructuraID);
  formData.append("x", x_rel);
  formData.append("y", y_rel);
  formData.append("descripcion", descripcion);
  formData.append("foto", fotoBase64);

  fetch("https://script.google.com/macros/s/AKfycbwKvwuzkv2Y0y9cZ6zd2iXnIMM7m2wykanQtjCLOcotbTMl8Y5BXlH4bVNH745HVtOWkQ/exec", {
    method: "POST",
    body: formData,
    mode: "no-cors"
  })
  .then(response => response.text())
  .then(data => {
    console.log(data);
    alert("Guardado correctamente");
    location.reload();
  })
  .catch(error => {
    console.error("Error:", error);
  });
}

</script>

</body>
</html>













<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Inspección</title>
<style>
body { margin:0; overflow:hidden; }
#container { position:relative; width:100vw; height:100vh; }
#plano { width:100%; height:100%; object-fit:contain; }
.marker {
  position:absolute;
  width:14px;
  height:14px;
  background:red;
  border-radius:50%;
}
#popup {
  position:fixed;
  bottom:0;
  left:0;
  width:100%;
  background:white;
  padding:10px;
  display:none;
}
</style>
</head>
<body>

<div id="container">
  <img id="plano">
</div>

<div id="popup">
  <textarea id="descripcion" placeholder="Descripción"></textarea>
  <input type="file" id="foto" accept="image/*" capture="environment">
  <button onclick="guardar()">Guardar</button>
</div>

<script>
let estructuraID = "";
let x_rel = 0;
let y_rel = 0;

const params = new URLSearchParams(window.location.search);
estructuraID = params.get("id");
document.getElementById("plano").src = params.get("plano");

document.getElementById("container").addEventListener("click", function(e){
  const rect = this.getBoundingClientRect();
  x_rel = (e.clientX - rect.left) / rect.width;
  y_rel = (e.clientY - rect.top) / rect.height;

  mostrarPopup();
});

function mostrarPopup(){
  document.getElementById("popup").style.display="block";
}

function guardar(){
  const descripcion = document.getElementById("descripcion").value;
  const file = document.getElementById("foto").files[0];

  const reader = new FileReader();
  reader.onload = function(){
    enviarDatos(descripcion, reader.result);
  };
  reader.readAsDataURL(file);
}

function enviarDatos(descripcion, fotoBase64){
  fetch("https://script.google.com/macros/s/AKfycbxex1wDkq8ZBzv3TDfvqpmmkLiruBjaum94IkFJNT4IPtjIwMaMjv0vKcjua8kxSjRN8g/exec", {
    method:"POST",
    body:JSON.stringify({
      id_estructura:estructuraID,
      x:x_rel,
      y:y_rel,
      descripcion:descripcion,
      foto:fotoBase64
    })
  }).then(()=>{
    location.reload();
  });
}
</script>

</body>
</html>




